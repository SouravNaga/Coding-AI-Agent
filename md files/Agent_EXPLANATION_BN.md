# Agent.js тАФ рж▓рж╛ржЗржирзЗ рж▓рж╛ржЗржирзЗ ржмрж╛ржВрж▓рж╛ ржмрзНржпрж╛ржЦрзНржпрж╛ (AтЖТZ)

ржПржЗ ржлрж╛ржЗрж▓ржЯрж┐ `Agent.js`тАСржПрж░ ржкрзНрж░рждрж┐ржЯрж┐ рж▓рж╛ржЗржирзЗрж░ ржмрж╛ржВрж▓рж╛ ржмрзНржпрж╛ржЦрзНржпрж╛ ржжрзЗржпрж╝ тАФ ржпрж╛рждрзЗ ржЖржкржирж┐ рж╕рж╣ржЬрзЗ ржмрзБржЭрждрзЗ ржкрж╛рж░рзЗржи ржкрзНрж░рждрж┐ржЯрж┐ ржЕржВрж╢ ржХрж┐ ржХрж░рзЗред

---

## рж╕ржВржХрзНрж╖рж┐ржкрзНржд рж╕рж╛рж░рж╛ржВрж╢
ржПржЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржПржХржЯрж┐ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓тАСржнрж┐рждрзНрждрж┐ржХ ржЪрзНржпрж╛ржЯ ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ ржжрзЗржпрж╝ ржпрзЗржЦрж╛ржирзЗ ржЗржЙржЬрж╛рж░ ржЗржиржкрзБржЯ ржжрж┐рж▓рзЗ `groq-sdk`тАСржПрж░ chat completion ржХрж▓ ржХрж░рзЗ ржоржбрзЗрж▓ рж░рзЗрж╕ржкржирзНрж╕ ржжрзЗржпрж╝ред ржХржерзЛржкржХржержи ржЗрждрж┐рж╣рж╛рж╕ (`messages` ржЕрзНржпрж╛рж░рзЗ) рж░рж╛ржЦрж╛ рж╣ржпрж╝ ржПржмржВ ржкрзНрж░рждрзНржпрзЗржХржмрж╛рж░ ржоржбрзЗрж▓ржХрзЗ рж╕рж░рзНржмрж╢рзЗрж╖ ржХржпрж╝рзЗржХржЯрж┐ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝ред

---

## рж▓рж╛ржЗржирзЗ рж▓рж╛ржЗржирзЗ ржмрзНржпрж╛ржЦрзНржпрж╛
> ржирзЛржЯ: ржирж┐ржЪрзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржХрзЛржб рж▓рж╛ржЗржирзЗрж░ ржХрзЛржб ржмрзНрж▓ржХ ржУ рждрж╛рж░ ржирж┐ржЪрзЗ ржмрж╛ржВрж▓рж╛ ржмрзНржпрж╛ржЦрзНржпрж╛ ржЖржЫрзЗред

1) ```javascript
import Groq from 'groq-sdk';
```
   - `groq-sdk` ржерзЗржХрзЗ `Groq` ржХрзНрж▓рж╛рж╕ ржЗржорзНржкрзЛрж░рзНржЯ ржХрж░рзЗ; ржПржЯрж╛ API ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝ред

2) ```javascript
import readline from 'readline';
```
   - Node ржПрж░ `readline` ржоржбрж┐ржЙрж▓ ржЗржорзНржкрзЛрж░рзНржЯ ржХрж░рзЗ, ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ ржерзЗржХрзЗ ржЗржЙржЬрж╛рж░ ржЗржиржкрзБржЯ ржирзЗржпрж╝рж╛рж░ ржЬржирзНржпред

3) ```javascript
(async () => {
```
   - ржПржХржЯрж┐ **ржЗржирж╕рзНржЯрзНржпрж╛ржирзНржЯ-рж░рж╛ржирж┐ржВ async IIFE** (immediately invoked function) рж╢рзБрж░рзБ ржХрж░рзЗ тАФ ржПрждрзЗ top-level await ржирж╛ ржерж╛ржХрж▓рзЗ ржУ async ржХрзЛржб ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржпрж╝ред

4) ```javascript
  try {
    await import('dotenv/config');
  } catch (e) {
    console.warn('dotenv not found; ensure env vars are set or run with `npm run dev` (node --env-file=.env).');
  }
```
   - ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЗ `dotenv` рж▓рзЛржб ржХрж░рждрзЗ ржпрж╛рждрзЗ `.env` ржерзЗржХрзЗ ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржкржбрж╝рзЗ ржЖрж╕рзЗред
   - ржпржжрж┐ `dotenv` ржЗржирж╕рзНржЯрж▓ ржирж╛ ржерж╛ржХрзЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржХрзНрж░рзНржпрж╛рж╢ ржирж╛ ржХрж░рзЗ, ржПржХржЯрж┐ ржУржпрж╝рж╛рж░рзНржирж┐ржВ ржжрзЗржЦрж╛ржпрж╝ (ржлрж▓рждрзБ ржнрж╛ржЩржЪрзБрж░ ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рзЗ)ред

5) ```javascript
  const API_KEY = process.env.GROQ_API_KEY;
```
   - ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржерзЗржХрзЗ `GROQ_API_KEY` ржирж┐ржЫрзЗ тАФ ржПржЯрж╛ API ржХрж▓ ржХрж░рж╛рж░ ржЬржирзНржп ржкрзНрж░ржпрж╝рзЛржЬржиред

6) ```javascript
  if (!API_KEY) {
    console.error('Missing GROQ_API_KEY in environment. Set it in .env or your environment variables.');
    process.exit(1);
  }
```
   - ржпржжрж┐ API ржХрзА ржирж╛ ржерж╛ржХрзЗ рждрж╛рж╣рж▓рзЗ ржЗржЙржЬрж╛рж░ржХрзЗ ржЬрж╛ржирж┐ржпрж╝рзЗ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржмржирзНржз ржХрж░рзЗ ржжрзЗржпрж╝ (ржирж┐рж░рж╛ржкрждрзНрждрж╛/ржмрзНржпрж░рзНржерждрж╛ ржирж┐ржпрж╝ржирзНрждрзНрж░ржг)ред

7) ```javascript
  const groq = new Groq({ apiKey: API_KEY });
```
   - `Groq` ржХрзНрж▓рж╛рж╕рзЗрж░ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ рждрзИрж░рж┐ ржХрж░рзЗ ржПржмржВ API ржХрзА ржжрж┐ржпрж╝рзЗ рж╕рзЗржЯ ржХрж░рзЗ тАФ ржПржЦржи ржПржЗ `groq` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржоржбрзЗрж▓ржХрзЗ ржХрж▓ ржХрж░рж╛ ржпрж╛ржмрзЗред

8) ```javascript
  // Conversation state: start with a system message and add user/assistant messages
  const systemMessage = {
    role: 'system',
    content: 'You are a helpful coding assistant. Provide concise, runnable code only when asked. Be polite and brief.'
  };
```
   - ржПржХржЯрж┐ **system message** рждрзИрж░рж┐ ржХрж░рзЗ ржпрзЗржЯрж╛ ржоржбрзЗрж▓ржХрзЗ ржирж┐рж░рзНржжрзЗрж╢ ржжрзЗржпрж╝ ржХрж┐ржнрж╛ржмрзЗ ржЖржЪрж░ржг ржХрж░рждрзЗ рж╣ржмрзЗ (assistant-ржПрж░ policy/behavior)ред

9) ```javascript
  const messages = [systemMessage];
```
   - `messages` ржЕрзНржпрж╛рж░рзЗ ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рзЗ ржПржмржВ ржкрзНрж░ржержорзЗ `systemMessage` рж░рж╛ржЦрзЗ тАФ ржПржЗ ржЕрзНржпрж╛рж░рзЗ ржкрзБрж░рзЛ ржХржерзЛржкржХржержирзЗрж░ history ржзрж░рзЗ рж░рж╛ржЦрзЗ (context)ред

10) ```javascript
  const rl = readline.createInterface({ input: process.stdin, output: process.stdout });
```
   - `readline` ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ рждрзИрж░рж┐ ржХрж░рзЗ ржпрж╛рждрзЗ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ ржерзЗржХрзЗ ржкрзНрж░рж╢рзНржи ржХрж░рзЗ ржЙрждрзНрждрж░ ржирзЗржУржпрж╝рж╛ ржпрж╛ржпрж╝ред

11) ```javascript
  function ask(question) {
    return new Promise((resolve) => rl.question(question, resolve));
  }
```
   - `ask` ржирж╛ржоржХ рж╣рзЗрж▓рзНржкрж╛рж░ ржлрж╛ржВрж╢ржи ржпрж╛ `rl.question` ржХрзЗ Promise-ржП рж░рзНржпрж╛ржк ржХрж░рзЗ тАФ `await ask('...')` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝ред

12) ```javascript
  async function chatLoop() {
    console.log("Start chatting with the agent. Type 'Good Bye' to exit.\n");
```
   - `chatLoop` ржирж╛ржоржХ ржЕрзНржпрж╛рж╕рж┐ржВржХрзНрж░рзЛржирж╛рж╕ ржлрж╛ржВрж╢ржи рж╢рзБрж░рзБ ржХрж░рзЗ ржПржмржВ ржЗржЙржЬрж╛рж░ржХрзЗ ржирж┐рж░рзНржжрзЗрж╢ ржжрзЗржпрж╝ ржХрж┐ржнрж╛ржмрзЗ ржмрзЗрж░ рж╣рждрзЗ рж╣ржмрзЗред

13) ```javascript
    while (true) {
      const userInput = (await ask('You: ')).trim();

      if (!userInput) {
        continue; // ignore empty lines
      }
```
   - ржПржХржЯрж┐ ржЕржиржирзНржд рж▓рзБржк ржЖржЫрзЗ ржпрж╛ ржкрзНрж░рждрж┐ ржЪржХрзНрж░рзЗ `ask` ржжрж┐ржпрж╝рзЗ ржЗржЙржЬрж╛рж░рзЗрж░ ржЗржиржкрзБржЯ ржирзЗржпрж╝ред
   - ржЦрж╛рж▓рж┐ ржЗржиржкрзБржЯ ржерж╛ржХрж▓рзЗ рж▓рзБржк ржкрж░рзЗрж░ ржЗржЯрж╛рж░рзЗрж╢ржирзЗ ржЪрж▓рзЗ ржпрж╛ржпрж╝ (ржХрж┐ржЫрзБржЗ ржирзЗржпрж╝ ржирж╛)ред

14) ```javascript
      if (/^(good bye|goodbye|bye|exit|quit)$/i.test(userInput)) {
        console.log('Agent: Good Bye!');
        break;
      }
```
   - ржпржжрж┐ ржЗржЙржЬрж╛рж░ `Good Bye`, `goodbye`, `bye`, `exit`, ржмрж╛ `quit` ржЯрж╛ржЗржк ржХрж░рзЗ (ржХрзЗрж╕-ржЗржирж╕рзЗржирж╕рж┐ржЯрж┐ржн), рж▓рзБржк ржерзЗржорзЗ ржпрж╛ржпрж╝ ржПржмржВ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржмрзЗрж░ рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ред

15) ```javascript
      messages.push({ role: 'user', content: userInput });
```
   - ржЗржЙржЬрж╛рж░рзЗрж░ ржЗржиржкрзБржЯ ржПржЦржи `messages` ржЕрзНржпрж╛рж░рзЗрждрзЗ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝ тАФ ржПржЯрж┐ context ржП рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржпрж╝ред

16) ```javascript
      try {
        const recent = messages.slice(-20);
```
   - ржПржХржЯрж┐ ржЯрзНрж░рж╛ржЗ ржмрзНрж▓ржХ рж╢рзБрж░рзБ ржХрж░рзЗ; `messages.slice(-20)` ржжрж┐ржпрж╝рзЗ рж╕рж╛ржорзНржкрзНрж░рждрж┐ (ржлрж▓рзЗ рж╕рж░рзНржмрж╢рзЗрж╖ рзирзжржЯрж┐) ржмрж╛рж░рзНрждрж╛ ржирзЗржУржпрж╝рж╛ рж╣ржпрж╝ ржпрж╛рждрзЗ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ рж╕рж╛ржЗржЬ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗ ржерж╛ржХрзЗред

17) ```javascript
        const completion = await groq.chat.completions.create({
          messages: recent,
          model: process.env.MODEL || 'llama-3.3-70b-versatile'
        });
```
   - ржоржбрзЗрж▓ ржХрж▓ ржХрж░рж╛ рж╣ржпрж╝ тАФ `messages` рж╣рж┐рж╕рзЗржмрзЗ `recent` ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝ ржПржмржВ `model` ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржерзЗржХрзЗ ржЕржержмрж╛ ржбрж┐ржлрж▓рзНржЯ ржоржбрзЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред

18) ```javascript
        const assistantReply = completion?.choices?.[0]?.message?.content ?? '[no response]';
```
   - API рж░рзЗрж╕ржкржирзНрж╕ ржерзЗржХрзЗ ржкрзНрж░ржержо ржЪржпрж╝рзЗрж╕рзЗрж░ ржорзЗрж╕рзЗржЬ ржХржиржЯрзЗржирзНржЯ ржирзЗржУржпрж╝рж╛ рж╣ржпрж╝; ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ, `"[no response]"` ржжрзЗржЦрж╛ржпрж╝ред

19) ```javascript
        console.log('\nAgent:', assistantReply, '\n');
```
   - ржоржбрзЗрж▓тАСржПрж░ ржЕржирж╕рж╛рж░ ржХржорж╛ржирзНржб рж▓рж╛ржЗржитАСржП ржкрзНрж░рж┐ржирзНржЯ ржХрж░рзЗ ржЗржЙржЬрж╛рж░ржХрзЗ ржжрзЗржЦрж╛ржпрж╝ред

20) ```javascript
        messages.push({ role: 'assistant', content: assistantReply });
```
   - ржЕрзНржпрж╛рж╕рж┐рж╕рзНржЯрзНржпрж╛ржирзНржЯрзЗрж░ рж░рзЗрж╕ржкржирзНрж╕ржХрзЗ `messages` ржЕрзНржпрж╛рж░рзЗрждрзЗ ржпрзЛржЧ ржХрж░рзЗ ржпрж╛рждрзЗ ржкрж░ржмрж░рзНрждрзА ржкрзНрж░рж╢рзНржирзЗ ржкрзНрж░рж╕ржЩрзНржЧ рж╣рж┐рж╕рзЗржмрзЗ ржерж╛ржХрзЗред

21) ```javascript
      } catch (err) {
        console.error('Error calling Groq API:', err?.message ?? err);
      }
```
   - ржпржжрж┐ API ржХрж▓ ржлрзЗржЗрж▓ ржХрж░рзЗ, рж╕рзЗ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржПрж░рж░ рж▓ржЧ ржХрж░рж╛ рж╣ржпрж╝ ржХрж┐ржирзНрждрзБ ржкрзБрж░рзЛ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржХрзНрж░рзНржпрж╛рж╢ рж╣ржпрж╝ ржирж╛ (рж▓рзБржк ржЪрж▓ржмрзЗ ржмрж╛ ржЗржЙржЬрж╛рж░ ржПржЧрж┐ржпрж╝рзЗ ржпрж╛ржмрзЗ)ред

22) ```javascript
    }

    rl.close();
  }
```
   - рж▓рзБржк рж╢рзЗрж╖ рж╣рж▓рзЗ `readline` ржмржирзНржз ржХрж░рзЗред

23) ```javascript
  chatLoop();
})();
```
   - `chatLoop` ржХрж▓ ржХрж░рзЗ ржПржмржВ IIFE рж╢рзЗрж╖ ржХрж░рзЗ тАФ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж╢рзБрж░рзБ рж╣ржУржпрж╝рж╛рж░ ржкрж░рзЗ ржЪрзНржпрж╛ржЯ рж▓рзБржк ржЪрж╛рж▓рзБ ржерж╛ржХржмрзЗред

---

## ржХрзЛржерж╛ржпрж╝ context/states рж╕рзНржЯрзЛрж░ рж╣ржЪрзНржЫрзЗ? ЁЯза
- ржорзВрж▓ рж╕рзНржЯрзЛрж░: `const messages = [systemMessage];`
- ржЗржЙржЬрж╛рж░ ржорзЗрж╕рзЗржЬ ржпрзЛржЧ рж╣рзЯ: `messages.push({ role: 'user', content: userInput });`
- ржЕрзНржпрж╛рж╕рж┐рж╕рзНржЯрзНржпрж╛ржирзНржЯ ржорзЗрж╕рзЗржЬ ржпрзЛржЧ рж╣рзЯ: `messages.push({ role: 'assistant', content: assistantReply });`
- ржоржбрзЗрж▓рзЗ ржкрж╛ржарж╛ржирзЛ ржЕржВрж╢: `const recent = messages.slice(-20);` (рж╢рзЗрж╖ рзирзжржЯрж┐ ржмрж╛рж░рзНрждрж╛)

---

## ржЪрж╛рж▓рж╛ржирзЛрж░ ржХрж┐ржнрж╛ржмрзЗ (ржЯрж┐ржкрж╕) тЦ╢я╕П
- `.env` ржлрж╛ржЗрж▓рзЗ рж░рж╛ржЦрзБржи:
  ```text
  GROQ_API_KEY=sk-...your-key
  ```
- ржЪрж╛рж▓рж╛ржи (PowerShell):
  ```powershell
  npm run dev
  # ржЕржержмрж╛ рж╕рж░рж╛рж╕рж░рж┐
  node Agent.js
  ```
- ржпржжрж┐ PowerShell-ржП ExecutionPolicy рж╕ржорж╕рзНржпрж╛ ржХрж░рзЗ, ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи `npm.cmd run dev` ржЕржержмрж╛ `powershell -ExecutionPolicy Bypass -Command "npm run dev"`ред

---

## ржжрзНрж░рзБржд ржмрж╛ржВрж▓рж╛ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк (ржПржХ ржмрж╛ржХрзНржпрзЗ)
`Agent.js` ржПржХржЯрж┐ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓тАСржЪрзНржпрж╛ржЯ ржмржЯ ржпрж╛ ржЗржЙржЬрж╛рж░рзЗрж░ ржкрзНрж░рждрж┐ржЯрж┐ ржмрж╛рж░рзНрждрж╛ `messages` ржЕрзНржпрж╛рж░рзЗрждрзЗ рж░рзЗржЦрзЗ, ржкрзНрж░рж╛рж╕ржЩрзНржЧрж┐ржХ рж╢рзЗрж╖ ржХрж┐ржЫрзБ ржмрж╛рж░рзНрждрж╛ ржоржбрзЗрж▓рзЗ ржкрж╛ржарж┐рзЯрзЗ рж░рзЗрж╕ржкржирзНрж╕ ржжрзЗржЦрж╛рзЯред

---

### ржкрзНрж░ржпрж╝рзЛржЬржи рж╣рж▓рзЗ ржЖржорж┐ ржПржЗ ржлрж╛ржЗрж▓ ржерзЗржХрзЗ рж╕рж░рж╛рж╕рж░рж┐ ржХржкрж┐ ржХрж░рзЗ `src/api.js` ржЖрж▓рж╛ржжрж╛ ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░рзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐ ржмрж╛ ржмрж╛рж░рзНрждрж╛ рж▓рзЛржЧрж┐ржВ (NDJSON) ржпрзЛржЧ ржХрж░рзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐ тАФ ржмрж▓рж▓рзЗржЗ ржХрж░рж┐ред тЬЕ
